$(function(){$(".e .g_gary").css("color","#868686");$("#pwd").click(function(){window.location.href=$_CONFIG.domain+"my/changepwd.php";return false});$("#email").click(function(){editpage();$(".email").show()});$("#phone").click(function(){editpage();$(".phone").show()});$(".close").click(function(){pageclose()});$(".switchpage").click(function(){$(".ff").hide();if($(this).hasClass("email_change")){$(".email").show()}else{$(".phone").show()}});$(".center").click(function(){var a=$(this).parent();if(a.hasClass("phone")){changephone()}else{if(a.hasClass("email")){changeemail()}else{loginout()}}});$("#countryNum").change(function(){var b=$(this).val();var a=$("#countryNum option:checked").attr("value1");$("#viewNum").val(b);$("#nation").val(a)});$(".yzm").bind("click",click_send_sms);$(".bind").click(function(){accountidUntie.change();return false});$(".unbind").click(function(){var a=$(this).attr("value");accountidUntie.unbindConfirm(a);return false})});function loginout(){location.href=$_CONFIG.domain+"/my/logout.php";return false}var editpage=function(){$(".showinfo").hide();$(".changeinfo").show();$(".ff").hide()};var pageclose=function(){if($_CONFIG.template=="resume/baseinfo"||$_CONFIG.template=="resume/pastebaseinfo"||$_CONFIG.template=="resume/guide1"){$(".changeinfo").hide();$(".phone,.email").hide();$("#pageContent").show()}else{$(".changeinfo").hide();$(".showinfo").show()}return false};var pageguideclose=function(){$(".changeinfo").hide();$(".phone,.email").hide();$("#pageContent").show();return false};var changeemail=function(){var g=$(".old_email").val(),b=filterTitle($(".new_email")).toLowerCase(),e=filterTitle($(".old_pwd"));if(b==""){pop.ini([["请输入新邮箱","warn"]],["确定"]);return false}if(b==g){pop.ini([["邮箱已被使用，请更换邮箱或找回密码","warn"]],["确定"]);return false}if(e==""){pop.ini([["请输入密码","warn"]],["确定"]);return false}var c=$_CONFIG.domain+"/ajax/my/changeemail.ajax.php";var f={old_email:g,new_email:b,password:e};var a=ajaxRequest(c,f,"post","json");if(a.status==0){if(a.url){location.href=a.url}else{if(a.desc=="email已存在"){var d=document.location.protocol;if(d.indexOf("https")!="-1"){pop.ini([['新邮箱已被使用，请更换邮箱。您也可以<a href="https://login.51job.com/forgetpwd.php?display=h5&url=https%3A%2F%2Fm.51job.com%2Fmy%2Fsuccess.php">点此取回用户名和密码</a>（点击进入邮箱找回密码页 ）',"warn"]],["确定"])}else{pop.ini([['新邮箱已被使用，请更换邮箱。您也可以<a href="https://login.51job.com/forgetpwd.php?display=h5&url=http%3A%2F%2Fm.51job.com%2Fmy%2Fsuccess.php">点此取回用户名和密码</a>（点击进入邮箱找回密码页 ）',"warn"]],["确定"])}}else{pop.ini([[a.desc,"warn"]],["确定"])}}}else{if(a.status==1){if($_CONFIG.template=="resume/guide1"||$_CONFIG.template=="resume/baseinfo"||$_CONFIG.template=="resume/pastebaseinfo"){$("#fornextemail").remove();$("#newsemail").show();$("#baseinfoemail").attr("value",b);$("#baseinfoemail").text(b);pageguideclose()}else{$("#email .txt input").val(b);pageclose()}pop.ini([["邮箱修改成功，验证邮件已发送至您的邮箱"+b+"，请查收。如不及时验证，将不能收到来自51job的服务邮件"]],["确定"]);$(".old_email").val(b);$(".new_email,.old_pwd").val("");return false}}};var changephone=function(){var c=$("#mp_verifystatus").val();var h=filterTitle($("#new_phone")).trim();var g=filterTitle($("#old_phone")).trim();var b=filterTitle($("#smscode"));var f=filterTitle($("#nation"));var e=filterTitle($("#mpcountry"));var j=filterTitle($("#viewNum"));if(h==""){pop.ini([["请输入手机号","warn"]],["确定"]);return false}else{if(f=="CN"&&!isPhone(h)){pop.ini([["仅支持11位大陆手机号码，且以13、14、15、16、17、18、19开头","warn"]],["确定"]);return false}else{if((f=="HK"||f=="MO"||f=="TW"||f=="SG"||f=="JP"||f=="KR"||f=="US"||f=="CA"||f=="AU")&&(h.length<8||h.length>=15)||isNaN(h)==true){pop.ini([["手机号格式错误，请核对后重新输入","warn"]],["确定"]);return false}else{if(h.length>15||isNaN(h)==true){pop.ini([["手机号格式错误，请核对后重新输入","warn"]],["确定"]);return false}}}}if(c==3&&h==g&&(e==f)){pop.ini([["请输入新手机号","warn"]],["确定"]);return false}if(b==""){pop.ini([["请输入验证码","warn"]],["确定"]);return false}var a=$_CONFIG.domain+"/ajax/my/bindphone.ajax.php";var d={code:b,mobilephone:h,nation:f};var i=ajaxRequest(a,d,"post","json");if(i.status==1){if($_CONFIG.template=="resume/guide1"||$_CONFIG.template=="resume/pastebaseinfo"||$_CONFIG.template=="resume/baseinfo"){$("#err_mobilephone").hide();if(f=="CN"){$("#mobilephone").val(h);$("#showphone").removeClass("c_default").text(h)}else{$("#mobilephone").val(j.substr(1)+"-"+h);$("#showphone").removeClass("c_default").text(j.substr(1)+"-"+h)}pageguideclose()}else{if(f=="CN"){$("#phone .txt input").val(h)}else{$("#phone .txt input").val(j.substr(1)+"-"+h)}pageclose()}pop.ini([["保存成功！可使用新认证的手机号进行登录"]],["确定"]);$("#smscode").val("");$("#new_phone").val(h);return true}else{if(i.status==0){pop.ini([[i.desc,"warn"]],["确定"]);return false}}};var isPhone=function(a){var b=/^(1[3456789]{1,1}[0-9]{9,9})$/;return b.test(a)};var click_send_sms=function(){var b=$("#mp_verifystatus").val();var f=filterTitle($("#new_phone")).trim();var e=filterTitle($("#old_phone")).trim();var a=filterTitle($("#nation"));var d=filterTitle($("#mpcountry"));var c=filterTitle($("#viewNum"));if(f==""){pop.ini([["请输入手机号","warn"]],["确定"]);return false}else{if(a=="CN"&&!isPhone(f)){pop.ini([["仅支持11位大陆手机号码，且以13、14、15、16、17、18、19开头","warn"]],["确定"]);return false}else{if((a=="HK"||a=="MO"||a=="TW"||a=="SG"||a=="JP"||a=="KR"||a=="US"||a=="CA"||a=="AU")&&(f.length<8||f.length>=15)||isNaN(f)==true){pop.ini([["手机号格式错误，请核对后重新输入","warn"]],["确定"]);return false}else{if(f.length>15||isNaN(f)==true){pop.ini([["手机号格式错误，请核对后重新输入","warn"]],["确定"]);return false}}}}if(b==3&&f==e&&(d==a)){pop.ini([["请输入新手机号","warn"]],["确定"]);return false}sendsms(f,a);return false};var sendsms=function(e,c){$(".yzm").unbind("click");var b=$_CONFIG.domain+"ajax/my/sendverifycode.ajax.php";var d={mobilephone:e,nation:c};var a=ajaxRequest(b,d,"post","json");if(a.status==1){countDown();return false}else{$(".yzm").bind("click",click_send_sms);pop.ini([[a.desc,"warn"]],["确定"]);return false}};var time_binphone=60;var countDown=function(){if(time_binphone>0){time_binphone--;$(".yzm").text(time_binphone+"秒后重发");var a=setTimeout("countDown()",1000)}else{time_binphone=60;$(".yzm").text("重新发送");$(".yzm").bind("click",click_send_sms)}};var accountidUntie={change:function(){if($(".bind").hasClass("ex")){$(".bind").removeClass("ex");$(".thirdaccount").hide()}else{$(".bind").addClass("ex");$(".thirdaccount").show()}return true},unbindConfirm:function(c){var a={wx:"微信",qq:"QQ",wb:"微博"};var d=["确定要与"+a[c]+"解除绑定吗？解绑后将无法使用"+a[c]+"进行登录"];var b=[["取消","确定"],["pop.close()","accountidUntie.unbindaccount('"+c+"')"]];pop.ini(d,b);return true},unbindaccount:function(d){var c=$_CONFIG.domain+"ajax/my/unbindaccount.ajax.php";var e={type:d};var b=ajaxRequest(c,e,"post","json");if(b.status==1){if($("#env").val()=="weixin"&&d=="wx"){window.location.href=$_CONFIG.domain;return true}var a=$(".unbind").length;$(".unbind").each(function(){if($(this).attr("value")==d){$(this).remove();a--;return false}});if(a<1){$(".thirdaccount").remove();$(".bind").unbind().addClass("en").removeClass("bind").removeClass("ex").append('<div class="txt tr">未绑定第三方账号</div>')}pop.close();return true}else{if(b.status=="-1"){window.location.reload();return false}else{pop.ini([[b.desc,"warn"]],["确定"]);return false}}}};